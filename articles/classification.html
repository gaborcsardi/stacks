<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stacks">
<title>Classification Models With stacks • stacks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.1/font.css" rel="stylesheet">
<link href="../deps/_Source%20Code%20Pro-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classification Models With stacks">
<meta property="og:description" content="stacks">
<meta property="og:image" content="https://stacks.tidymodels.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="stacks.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stacks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/basics.html">Getting Started With stacks</a>
    <a class="dropdown-item" href="../articles/classification.html">Classification Models With stacks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/stacks/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Classification Models With stacks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/stacks/blob/HEAD/vignettes/classification.Rmd" class="external-link"><code>vignettes/classification.Rmd</code></a></small>
      <div class="d-none name"><code>classification.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we’ll tackle a multiclass classification problem
using the stacks package. This vignette assumes that you’re familiar
with tidymodels “proper,” as well as the basic grammar of the package,
and have seen it implemented on numeric data; if this is not the case,
check out the “Getting Started With stacks” vignette!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stacks.tidymodels.org/">stacks</a></span><span class="op">)</span></code></pre></div>
<p>In this example, we’ll make use of the <code>tree_frogs</code> data
exported with <code>stacks</code>, giving experimental results on
hatching behavior of red-eyed tree frog embryos!</p>
<p>Red-eyed tree frog (RETF) embryos can hatch earlier than their normal
7ish days if they detect potential predator threat. Researchers wanted
to determine how, and when, these tree frog embryos were able to detect
stimulus from their environment. To do so, they subjected the embryos at
varying developmental stages to “predator stimulus” by jiggling the
embryos with a blunt probe. Beforehand, though, some of the embryos were
treated with gentamicin, a compound that knocks out their lateral line
(a sensory organ). Researcher Julie Jung and her crew found that these
factors inform whether an embryo hatches prematurely or not!</p>
<p>In this article, we’ll use most all of the variables in
<code>tree_frogs</code> to predict <code>reflex</code>, a measure of ear
function called the vestibulo-ocular reflex (VOR), categorized into
bins. Ear function increases from factor levels “low”, to “mid”, to
“full”.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"tree_frogs"</span><span class="op">)</span>

<span class="co"># subset the data</span>
<span class="va">tree_frogs</span> <span class="op">&lt;-</span> <span class="va">tree_frogs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">clutch</span>, <span class="va">latency</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s plot the data to get a sense for how separable these groups
are.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tree_frogs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">reflex</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Embryo Age (s)"</span>, 
       x <span class="op">=</span> <span class="st">"treatment"</span>,
       color <span class="op">=</span> <span class="st">"Response"</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>It looks like the embryo age is pretty effective at picking out
embryos with full VOR function, but the problem gets tougher for the
less developed embryos! Let’s see how well the stacked ensemble can
classify these tree frogs.</p>
<div class="section level2">
<h2 id="defining-candidate-ensemble-members">Defining candidate ensemble members<a class="anchor" aria-label="anchor" href="#defining-candidate-ensemble-members"></a>
</h2>
<p>As in the numeric prediction setting, defining the candidate ensemble
members is undoubtedly the longest part of the ensembling process with
stacks. First, splitting up the training data, generating resamples, and
setting some options that will be used by each model definition.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># some setup: resampling and a basic recipe</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">tree_frogs_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span><span class="va">tree_frogs</span><span class="op">)</span>
<span class="va">tree_frogs_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">tree_frogs_split</span><span class="op">)</span>
<span class="va">tree_frogs_test</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">tree_frogs_split</span><span class="op">)</span>

<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html" class="external-link">vfold_cv</a></span><span class="op">(</span><span class="va">tree_frogs_train</span>, v <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="va">tree_frogs_rec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">reflex</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tree_frogs_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">reflex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html" class="external-link">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">tree_frogs_wflow</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">add_recipe</a></span><span class="op">(</span><span class="va">tree_frogs_rec</span><span class="op">)</span></code></pre></div>
<p>We also need to use the same control settings as in the numeric
response setting:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctrl_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/control_stack.html">control_stack_grid</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We’ll define two different model definitions to try to predict
<code>reflex</code>—a random forest and a neural network.</p>
<p>Starting out with a random forest:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rand_forest_spec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">rand_forest</a></span><span class="op">(</span>
    mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hardhat/man/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>,
    min_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hardhat/man/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>,
    trees <span class="op">=</span> <span class="fl">500</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span>

<span class="va">rand_forest_wflow</span> <span class="op">&lt;-</span>
  <span class="va">tree_frogs_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">rand_forest_spec</span><span class="op">)</span>

<span class="va">rand_forest_res</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://tune.tidymodels.org/reference/tune_grid.html" class="external-link">tune_grid</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">rand_forest_wflow</span>, 
    resamples <span class="op">=</span> <span class="va">folds</span>, 
    grid <span class="op">=</span> <span class="fl">10</span>,
    control <span class="op">=</span> <span class="va">ctrl_grid</span>
  <span class="op">)</span></code></pre></div>
<p>Now, moving on to the neural network model definition:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnet_spec</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/mlp.html" class="external-link">mlp</a></span><span class="op">(</span>hidden_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hardhat/man/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>, penalty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hardhat/man/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span>, epochs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/hardhat/man/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"nnet"</span><span class="op">)</span>

<span class="va">nnet_rec</span> <span class="op">&lt;-</span> 
  <span class="va">tree_frogs_rec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">nnet_wflow</span> <span class="op">&lt;-</span> 
  <span class="va">tree_frogs_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">nnet_spec</span><span class="op">)</span>

<span class="va">nnet_res</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://tune.tidymodels.org/reference/tune_grid.html" class="external-link">tune_grid</a></span><span class="op">(</span>
    object <span class="op">=</span> <span class="va">nnet_wflow</span>, 
    resamples <span class="op">=</span> <span class="va">folds</span>, 
    grid <span class="op">=</span> <span class="fl">10</span>,
    control <span class="op">=</span> <span class="va">ctrl_grid</span>
  <span class="op">)</span></code></pre></div>
<p>With these model definitions fully specified, we’re ready to start
putting together an ensemble!</p>
</div>
<div class="section level2">
<h2 id="putting-together-a-stack">Putting together a stack<a class="anchor" aria-label="anchor" href="#putting-together-a-stack"></a>
</h2>
<p>Building the stacked ensemble, now, only takes a few lines:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_frogs_model_st</span> <span class="op">&lt;-</span> 
  <span class="co"># initialize the stack</span>
  <span class="fu"><a href="../reference/stacks.html">stacks</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># add candidate members</span>
  <span class="fu"><a href="../reference/add_candidates.html">add_candidates</a></span><span class="op">(</span><span class="va">rand_forest_res</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_candidates.html">add_candidates</a></span><span class="op">(</span><span class="va">nnet_res</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># determine how to combine their predictions</span>
  <span class="fu"><a href="../reference/blend_predictions.html">blend_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># fit the candidates with nonzero stacking coefficients</span>
  <span class="fu"><a href="../reference/fit_members.html">fit_members</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">tree_frogs_model_st</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 4</span></span>
<span class="co">#&gt;    member                          type        weight class</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> .pred_full_nnet_res_1_09        mlp          142.  low  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> .pred_mid_nnet_res_1_05         mlp           49.8 low  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> .pred_mid_nnet_res_1_06         mlp           40.7 low  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> .pred_mid_rand_forest_res_1_01  rand_forest   39.9 low  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> .pred_mid_nnet_res_1_01         mlp           30.9 low  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> .pred_mid_rand_forest_res_1_10  rand_forest   26.7 mid  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> .pred_mid_rand_forest_res_1_07  rand_forest   23.4 low  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> .pred_mid_rand_forest_res_1_05  rand_forest   23.1 mid  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> .pred_full_rand_forest_res_1_09 rand_forest   14.4 full </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> .pred_mid_rand_forest_res_1_09  rand_forest   13.7 mid</span></code></pre></div>
<p>To make sure that we have the right trade-off between minimizing the
number of members and optimizing performance, we can use the
<code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/penalty-plot-1.png" width="768"></p>
<p>To show the relationship more directly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, type <span class="op">=</span> <span class="st">"members"</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/members-plot-1.png" width="768"></p>
<p>If these results were not good enough,
<code><a href="../reference/blend_predictions.html">blend_predictions()</a></code> could be called again with different
values of <code>penalty</code>. As it is,
<code><a href="../reference/blend_predictions.html">blend_predictions()</a></code> picks the penalty parameter with the
numerically optimal results. To see the top results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, type <span class="op">=</span> <span class="st">"weights"</span><span class="op">)</span></code></pre></div>
<p><img src="classification_files/figure-html/weight-plot-1.png" width="768"></p>
<p>There are multiple facets since the ensemble members can have
different effects on different classes.</p>
<p>To identify which model configurations were assigned what stacking
coefficients, we can make use of the <code><a href="../reference/collect_parameters.html">collect_parameters()</a></code>
function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/collect_parameters.html">collect_parameters</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, <span class="st">"rand_forest_res"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 60 × 6</span></span>
<span class="co">#&gt;    member                mtry min_n class terms                       coef</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> rand_forest_res_1_01     1    26 low   .pred_mid_rand_forest_r… 3.99<span style="color: #949494;">e</span>+1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> rand_forest_res_1_01     1    26 low   .pred_full_rand_forest_… 4.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> rand_forest_res_1_01     1    26 mid   .pred_mid_rand_forest_r… 0   <span style="color: #949494;"> </span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> rand_forest_res_1_01     1    26 mid   .pred_full_rand_forest_… 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> rand_forest_res_1_01     1    26 full  .pred_mid_rand_forest_r… 0   <span style="color: #949494;"> </span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> rand_forest_res_1_01     1    26 full  .pred_full_rand_forest_… 0   <span style="color: #949494;"> </span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> rand_forest_res_1_02     2    33 low   .pred_mid_rand_forest_r… 0   <span style="color: #949494;"> </span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> rand_forest_res_1_02     2    33 low   .pred_full_rand_forest_… 0   <span style="color: #949494;"> </span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> rand_forest_res_1_02     2    33 mid   .pred_mid_rand_forest_r… 5.87<span style="color: #949494;">e</span>+0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> rand_forest_res_1_02     2    33 mid   .pred_full_rand_forest_… 5.66<span style="color: #949494;">e</span>+0</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 50 more rows</span></span></code></pre></div>
<p>This object is now ready to predict with new data!</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_frogs_pred</span> <span class="op">&lt;-</span>
  <span class="va">tree_frogs_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">tree_frogs_model_st</span>, <span class="va">.</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Computing the ROC AUC for the model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">(</span>
  <span class="va">tree_frogs_pred</span>,
  truth <span class="op">=</span> <span class="va">reflex</span>,
  <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">".pred_"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>Looks like our predictions were pretty strong! How do the stacks
predictions perform, though, as compared to the members’ predictions? We
can use the <code>members</code> argument to generate predictions from
each of the ensemble members.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_frogs_pred</span> <span class="op">&lt;-</span>
  <span class="va">tree_frogs_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">reflex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
      <span class="va">tree_frogs_model_st</span>,
      <span class="va">tree_frogs_test</span>,
      type <span class="op">=</span> <span class="st">"class"</span>,
      members <span class="op">=</span> <span class="cn">TRUE</span>
      <span class="op">)</span>
    <span class="op">)</span>

<span class="va">tree_frogs_pred</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 303 × 21</span></span>
<span class="co">#&gt;    reflex .pred_class .pred_class_rand_… .pred_class_ran… .pred_class_ran…</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> mid    full        low                mid              mid             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> mid    full        mid                mid              mid             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> mid    full        low                low              low             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> full   low         full               full             full            </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 293 more rows, and 16 more variables:</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .pred_class_rand_forest_res_1_05 &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .pred_class_rand_forest_res_1_09 &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .pred_class_nnet_res_1_05 &lt;fct&gt;, .pred_class_nnet_res_1_06 &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .pred_class_nnet_res_1_04 &lt;fct&gt;, .pred_class_nnet_res_1_10 &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .pred_class_nnet_res_1_01 &lt;fct&gt;, .pred_class_nnet_res_1_09 &lt;fct&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .pred_class_rand_forest_res_1_10 &lt;fct&gt;, …</span></span>

<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span><span class="op">)</span><span class="op">)</span>,
  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span><span class="op">$</span><span class="va">reflex</span> <span class="op">==</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">tree_frogs_pred</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="va">reflex</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 3</span></span>
<span class="co">#&gt;    reflex name                              value</span>
<span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      1 .pred_class                      0.062<span style="text-decoration: underline;">7</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      1 .pred_class_rand_forest_res_1_01 0.835 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      1 .pred_class_rand_forest_res_1_04 0.875 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      1 .pred_class_rand_forest_res_1_07 0.871 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      1 .pred_class_rand_forest_res_1_05 0.845 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      1 .pred_class_rand_forest_res_1_09 0.884 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      1 .pred_class_nnet_res_1_05        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      1 .pred_class_nnet_res_1_06        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      1 .pred_class_nnet_res_1_04        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      1 .pred_class_nnet_res_1_10        0.842 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span>      1 .pred_class_nnet_res_1_01        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span>      1 .pred_class_nnet_res_1_09        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span>      1 .pred_class_rand_forest_res_1_10 0.868 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span>      1 .pred_class_rand_forest_res_1_02 0.878 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span>      1 .pred_class_rand_forest_res_1_06 0.878 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span>      1 .pred_class_rand_forest_res_1_08 0.881 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span>      1 .pred_class_nnet_res_1_08        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">18</span>      1 .pred_class_nnet_res_1_07        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">19</span>      1 .pred_class_nnet_res_1_02        0.558 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">20</span>      1 .pred_class_nnet_res_1_03        0.558</span></code></pre></div>
<p>Voilà! You’ve now made use of the stacks package to predict tree frog
embryo ear function using a stacked ensemble!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Simon Couch, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.rstudio.com" class="external-link"><img src="https://www.tidyverse.org/rstudio-logo.svg" alt="RStudio" width="72"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

  </div></footer>
</body>
</html>
